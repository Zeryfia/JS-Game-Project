"use strict";

const chooseRule = (a, b, arr) => {

	for (let i=0; i < arr.length; i++) {

		if ( arr[i].indexOf(a) != -1 && arr[i].indexOf(b) != -1 )
			return i;
	}

}

const ruleInterpreter = (player, comp, rule, arr) => {

	let round = rule.split('');

	let winner = round[0];


	if (player == winner)
	
		return `Player won! ${arr[player]} beats ${arr[comp]}`;
	
	
	else if (comp == winner) 

		return `Computer won! ${arr[comp]} beats ${arr[player]}`;	
}

const validateMove = (text, arr) => {

	let temp = text.trim();

	let input = temp.toLowerCase();

	if ( arr.indexOf(input) != -1 )

		return input;

	else
		return false;
}

const handleUserInput = (round, max, arr) => {

	let accepted = false;

	while (!accepted) {

		let userText = prompt(`Round ${round+1}/${max} ENTER YOUR OPTION`);

		accepted = validateMove(userText, arr);

		if (!accepted)
			alert("Wrong command! Please enter: 'rock', 'scissors', or 'paper'.")
		else
			return accepted;
	}

}

const playRound = (playerSelection, computerSelection, moves, rules, score) => {


	if ( playerSelection === computerSelection )

		alert(`This round\'s result is a Draw! Score stays the same P ${score['player']} : C ${score['comp']}`);

	else {

		let playerPos = moves.indexOf(playerSelection);

		let computerPos = moves.indexOf(computerSelection);


		let rulePos = chooseRule(playerPos, computerPos, rules);

		let outcome = ruleInterpreter(playerPos, computerPos, rules[rulePos], moves);

		let temp = outcome.split(' ');

		let victor = temp[0];


		if (victor === "Player") {

			score['player'] += 1;

			alert( `${outcome}. Score P ${score['player']} : C ${score['comp']}` );

		}

		else if (victor === "Computer"  ) {

			score['comp'] += 1;

			alert( `${outcome}. Score C ${score['comp']} : P ${score['player']}` );

		}

	}

}

const getFinalResult = (score) => {

	if ( score['player'] == score['comp'] )

		alert(`The final result of the game is a DRAW, the score is P ${score['player']} : C ${score['comp']}`);

	else {

		let champion = ( score['player'] > score['comp'] ? "Player" : "Computer" );

		alert (`The Winner of this game is ${champion}, the score is Player ${score['player']} : Computer ${score['comp']} `);
	}
}


(function () {

	const moves = ['rock', 'scissors', 'paper'];

	const rules = ['01', '20', '12'];

	const maxRounds = 5;

	let score = {"player": 0, "comp": 0};

	let playerSelection = null;

	let computerSelection = null;

	try {
			for (let i=0; i < maxRounds; i++)
			{
				
				playerSelection = handleUserInput(i, maxRounds, moves);

				computerSelection = moves[Math.floor(Math.random()*moves.length)];

				alert("Computer\'s selection is " + computerSelection.toUpperCase());

				playRound(playerSelection, computerSelection, moves, rules, score);
			}

			getFinalResult(score);
	}

	catch (err) {

		alert("You have exited the game");
	}

})();

