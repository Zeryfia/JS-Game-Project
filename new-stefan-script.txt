"use strict";

const computerPlay = (list) => {

	let option = null;

	let random = Math.floor(Math.random()*list.length);

	option = list[random];

	return option;
}

const validateMove = (text, arr) => {

	let temp = text.trim();

	let input = temp.toLowerCase();

	if ( arr.indexOf(input) != -1 )

		return input;

	else
		return false;
}

const handleUserInput = (round, max, arr) => {

	let accepted = false;

	while (!accepted) {

		let userText = prompt(`Round ${round+1}/${max} ENTER YOUR OPTION`);

		accepted = validateMove(userText, arr);

		if (!accepted)
			alert("Wrong command! Please enter: 'rock', 'scissors', or 'paper'.")
		else
			return accepted;
	}

}

const PlayRound = (playerSelection, computerSelection) => {

	let output = null;

	if ( playerSelection === computerSelection )

		output = "It is a Draw!";

	else {

		switch(playerSelection) {

			case 'rock':

			if (computerSelection == 'scissors') 
				output = "You win! Rock beats Scissors";

			else if (computerSelection == 'paper') 
				output = "You lose! Paper beats Rock";
			
			break;

			case 'scissors':

			if (computerSelection == 'paper') 
				output = "You win! Scissors beat Paper";
			
			else if (computerSelection == 'rock') 
				output = "You lose! Rock beats Scissors";

			break;

			case 'paper':

			if (computerSelection == 'rock') 
				output = "You win! Paper beats Rock";
			
			else if (computerSelection == 'scissors') 
				output = "You lose! Scissors beat Paper";

			break;

			default: output = "default";

		}
	}

	return output;
}

const evaluateRound = (result, score, i) => {

	if (result.includes("win"))
		score['player'] += 1;

	else if (result.includes("lose"))
		score['comp'] += 1;

	console.log(`Round ${i+1}. ${result}. Score You ${score['player']} : Comp ${score['comp']} `);

}

const getFinalResult = (score) => {

	if ( score['player'] == score['comp'] )

		console.log(`The Final result of the game is a DRAW, the score is P ${score['player']} : C ${score['comp']}`);

	else {

		let champion = ( score['player'] > score['comp'] ? "Player" : "Computer" );

		console.log(`The Winner of this game is ${champion}, the score is Player ${score['player']} : Computer ${score['comp']} `);
	}
}


(function game() {

	const moves = ['rock', 'scissors', 'paper'];

	const maxRounds = 5;

	let score = {"player": 0, "comp": 0};

	let playerSelection = null;

	let computerSelection = null;

	try {
		for (let i=0; i < maxRounds; i++)
		{

			computerSelection = computerPlay(moves);
			
			playerSelection = handleUserInput(i, maxRounds, moves);

			alert("Computer\'s selection is " + computerSelection.toUpperCase());

			let roundResult = PlayRound(playerSelection, computerSelection);

			evaluateRound( roundResult, score, i );
		}

		getFinalResult(score);
	}

	catch (err) {

		alert("You have exited the game");
	}

})();

