"use strict";

const tools = ["rock", "scissors", "paper"]

const toolsOutcomes = {
    rock: { scissors: "win", paper: "lose", rock: "tie" },
    paper: { rock: "win", scissors: "lose", paper: "tie" },
    scissors: { paper: "win", rock: "lose", scissors: "tie" }
}

const logAndAlert = (message) => {
    console.log(message);
    alert(message);
};

const parseUserInput = (text) => {
    let temp = text.trim();
    let input = temp.toLowerCase();
    return (tools.indexOf(input) != -1) ? input : null
}

const computerToolSelection = () => {
    let randomIndex = Math.floor(Math.random() * 3);
    return tools[randomIndex];
}

const playerToolSelection = () => {
    let userSelectedTool = null;
    do {
        let userInput = prompt("Choose your weapon: Rock, Paper, or Scissors");
        if (!userInput) return null;
        userSelectedTool = parseUserInput(userInput);
        if (!userSelectedTool) alert("Invalid choice! Please choose again: Rock, Paper, or Scissors")
    } while (!userSelectedTool);
    return userSelectedTool;
}

const cancelGame = () => {
    logAndAlert('The game has been canceled. Farewell!');
    return;
};

const playRound = (playerSelection, computerSelection) => {
    logAndAlert(`You wield ${playerSelection} with the hope of defeating the evil AI's ${computerSelection}!`);
    const roundOutcome = toolsOutcomes[playerSelection][computerSelection]
    roundOutcome === "tie"
        ? logAndAlert("It's a tie! Neither side prevails!")
        : roundOutcome === "win"
            ? logAndAlert(`Congratulations! Your ${playerSelection} crushes the evil AI's ${computerSelection}!`)
            : logAndAlert(`Oh no! The evil AI's ${computerSelection} dominates your ${playerSelection}!`);
    return roundOutcome;
}

const playAgain = () => {
    const isUserPlayingAgain = confirm('Do you dare to challenge the AI once more in your quest for the Artifact of Victory?');
    if (isUserPlayingAgain) {
        logAndAlert('Prepare yourself for another round of battle!');
        game();
    } else {
        logAndAlert('Thank you for your bravery, warrior. Until we meet again on the battlefield! Farewell!');
    }
};

const displayFinalResults = (playerPoints, computerPoints) => {
    playerPoints > computerPoints
        ? logAndAlert('Victory! With your indomitable spirit, you have overcome the AI and claimed the Artifact of Victory!')
        : playerPoints < computerPoints
            ? logAndAlert('Alas! The AI has proven too powerful this time. But fear not, for the battle continues until the Artifact of Victory is reclaimed!')
            : logAndAlert('It\'s a stalemate! Neither side emerges victorious. The battle rages on!');
}

const game = () => {
    let playerScore = 0;
    let computerScore = 0;
    let playerSelection = '';
    let computerSelection = '';

    for (let i = 1; i <= 5; i++) {
        logAndAlert(`Round ${i} begins!`);

        computerSelection = computerToolSelection();
        playerSelection = playerToolSelection();

        if (playerSelection === null) return cancelGame();

        let result = playRound(playerSelection, computerSelection);

        if (result === 'win') {
            playerScore++;
        } else if (result === 'lose') {
            computerScore++;
        } else {
            playerScore++;
            computerScore++;
        }

        logAndAlert(`The battle rages on! Your score: ${playerScore}, AI's score: ${computerScore}`);
    }

    displayFinalResults(playerScore, computerScore);

    playAgain();
}

logAndAlert("Welcome, brave warrior, to the Rock Paper Scissors Battle!");
logAndAlert(`In a world ravaged by the forces of darkness, a malevolent AI has risen to power, enslaving humanity and plunging the world into chaos.

But there is hope. Legends speak of an ancient artifact, the Artifact of Victory, said to possess the power to defeat the AI and restore peace to the land.

You, courageous hero, have been chosen to go on a perilous journey to reclaim the artifact and free humanity from the AI's tyranny.

Prepare yourself for a series of battles against the AI's minions. Only by emerging victorious in a best-of-five duel can you hope to claim the artifact.`);
logAndAlert(`Instructions:

1. Choose your weapon: Rock, Paper, or Scissors.

2. The AI will also choose its weapon.

3. The winner of each round is determined by the rules of Rock Paper Scissors.

4. Whoever wins the best-of-5 is declared the overall winner.`);

logAndAlert(`Are you ready to face the challenge and reclaim the Artifact of Victory? Let the battle begin!`);

game();